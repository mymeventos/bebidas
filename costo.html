<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Costos de Eventos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .calculator-container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            width: 100%;
        }
        #pdf-content {
            padding: 20px;
            background: #fff; /* asegura fondo blanco en PDF */
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        h2 {
            text-align: left;
            color: #555;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
            margin-top: 40px;
            margin-bottom: 20px;
        }
        .invitados-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        label {
            font-weight: 600;
            color: #555;
        }
        input[type="number"], input[type="text"], input[type="date"] {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
        }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            table-layout: fixed;
        }
        th, td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            width: 33.33%;
        }
        th {
            background-color: #f2f2f2;
            font-weight: 700;
            color: #444;
        }
        td#alcohol-persona,
        td#sin-alcohol-persona,
        td#comida-persona,
        td#pasteleria-persona,
        td#animador-persona,
        td#sonido-persona,
        td#mozos-persona,
        td#bacha-persona,
        td#barman-persona,
        td#decoracion-persona,
        td#varios-persona {
            color: #28a745;
            font-weight: 600;
            text-align: right;
        }
        td input[type="number"] {
            width: 80%;
            text-align: right;
            display: block;
            margin-left: auto;
        }
        #resumen-total {
            background-color: #007bff;
            color: white;
            padding: 20px 25px;
            border-radius: 8px;
            margin-top: 30px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
        }
        #resumen-total p {
            margin: 0;
            font-size: 1.2em;
            line-height: 1.6;
        }
        #costo-total, #costo-promedio-persona {
            font-size: 1.5em;
            font-weight: bold;
        }
        .save-button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s ease;
        }
        .save-button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>

    <div class="calculator-container">
        <div id="pdf-content">
            <h1>Calculadora de Costos de Eventos</h1>

            <h2>Datos del Evento</h2>
            <div class="event-details">
                <div>
                    <label for="event-title">Título del Evento:</label>
                    <input type="text" id="event-title" placeholder="Ej: Cumple de Mica">
                </div>
                <div>
                    <label for="event-date">Fecha del Evento:</label>
                    <input type="date" id="event-date">
                </div>
            </div>
            
            <div class="invitados-container">
                <div>
                    <label for="invitados-adultos">Cantidad de Invitados Adultos:</label>
                    <input type="number" id="invitados-adultos" value="0" min="0" oninput="calcular()">
                </div>
                <div>
                    <label for="invitados-infantiles">Cantidad de Invitados Infantiles:</label>
                    <input type="number" id="invitados-infantiles" value="0" min="0" oninput="calcular()">
                </div>
            </div>

            <h2>Detalle de Costos</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ítem</th>
                        <th>Costo Total ($)</th>
                        <th>Costo por Persona ($)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Bebidas alcohólicas</td><td><input type="number" id="alcohol" value="0" min="0" oninput="calcular()"></td><td id="alcohol-persona">0.00</td></tr>
                    <tr><td>Bebidas sin alcohol</td><td><input type="number" id="sin-alcohol" value="0" min="0" oninput="calcular()"></td><td id="sin-alcohol-persona">0.00</td></tr>
                    <tr><td>Comida</td><td><input type="number" id="comida" value="0" min="0" oninput="calcular()"></td><td id="comida-persona">0.00</td></tr>
                    <tr><td>Pastelería</td><td><input type="number" id="pasteleria" value="0" min="0" oninput="calcular()"></td><td id="pasteleria-persona">0.00</td></tr>
                    <tr><td>Animador</td><td><input type="number" id="animador" value="0" min="0" oninput="calcular()"></td><td id="animador-persona">0.00</td></tr>
                    <tr><td>Sonido</td><td><input type="number" id="sonido" value="0" min="0" oninput="calcular()"></td><td id="sonido-persona">0.00</td></tr>
                    <tr><td>Mozos</td><td><input type="number" id="mozos" value="0" min="0" oninput="calcular()"></td><td id="mozos-persona">0.00</td></tr>
                    <tr><td>Bacha</td><td><input type="number" id="bacha" value="0" min="0" oninput="calcular()"></td><td id="bacha-persona">0.00</td></tr>
                    <tr><td>Barman</td><td><input type="number" id="barman" value="0" min="0" oninput="calcular()"></td><td id="barman-persona">0.00</td></tr>
                    <tr><td>Decoración</td><td><input type="number" id="decoracion" value="0" min="0" oninput="calcular()"></td><td id="decoracion-persona">0.00</td></tr>
                    <tr><td>Varios</td><td><input type="number" id="varios" value="0" min="0" oninput="calcular()"></td><td id="varios-persona">0.00</td></tr>
                </tbody>
            </table>
            
            <h2>Resumen Final</h2>
            <div id="resumen-total">
                <p>Costo Total del Evento: $<span id="costo-total">0.00</span></p>
                <p>Costo Promedio por Persona: $<span id="costo-promedio-persona">0.00</span></p>
            </div>
        </div>
        
        <button class="save-button" onclick="guardarEventoPDF()">Descargar Resumen PDF</button>
    </div>

    <script>
        function calcular() {
            const adultos = parseFloat(document.getElementById('invitados-adultos').value) || 0;
            const infantiles = parseFloat(document.getElementById('invitados-infantiles').value) || 0;
            const totalInvitados = adultos + infantiles;

            let costoTotalEvento = 0;
            const items = ['alcohol','sin-alcohol','comida','pasteleria','animador','sonido','mozos','bacha','barman','decoracion','varios'];
            
            items.forEach(item => {
                const costoItem = parseFloat(document.getElementById(item).value) || 0;
                costoTotalEvento += costoItem;
                let costoPorPersona = 0;
                if (item === 'alcohol') {
                    if (adultos > 0) costoPorPersona = costoItem / adultos;
                } else {
                    if (totalInvitados > 0) costoPorPersona = costoItem / totalInvitados;
                }
                document.getElementById(`${item}-persona`).textContent = costoPorPersona.toFixed(2);
            });
            
            const costoPromedioPorPersona = totalInvitados > 0 ? costoTotalEvento / totalInvitados : 0;
            document.getElementById('costo-total').textContent = costoTotalEvento.toFixed(2);
            document.getElementById('costo-promedio-persona').textContent = costoPromedioPorPersona.toFixed(2);
        }

        async function guardarEventoPDF() {
            const titulo = document.getElementById('event-title').value;
            const fecha = document.getElementById('event-date').value;
            if (!titulo || !fecha) {
                alert('Por favor, complete el título y la fecha del evento antes de descargar el PDF.');
                return;
            }
            const element = document.getElementById('pdf-content');
            const canvas = await html2canvas(element, { scale: 2, useCORS: true });
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const imgProps = pdf.getImageProperties(imgData);
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

            let heightLeft = pdfHeight;
            let position = 0;

            pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
            heightLeft -= pdf.internal.pageSize.getHeight();

            while (heightLeft > 0) {
                position = heightLeft - pdfHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
                heightLeft -= pdf.internal.pageSize.getHeight();
            }

            pdf.save(`${titulo}_${fecha}.pdf`);
        }

        calcular();
    </script>
</body>
</html>
